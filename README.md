В результате интеграции в CRM системе должны создаться:
сделка (на этапе воронки “Первичный контакт” с названием “Заявка с сайта”). При создании сделки ей нужно установить ответственного, учитывая принцип распределения (см. ниже “Принцип работы распределения”).
задача с типом “Перезвонить клиенту”, ответственный у задачи должен быть такой же как и у сделки, а срок выполнения задачи 1 день;
контакт (см. “Создание контакта”).

Также все данные с формы должны отправляться на почту администратора аккаунта amoCRM с темой письма "Заявка с сайта".

Создание контакта

В процессе интеграции нужно создавать новый контакт, если не найден существующий по входящим данным (email и телефон). Поиск существующих контактов в CRM системе нужно производить в 2 этапа: сначала по email, а потом по телефону.
Если контакт не найден, то нужно создавать новую карточку контакта и крепить к нему созданную сделку. При этом контактные данные должны быть в карточке контакта.
Если контакт был найден, то к данному контакту крепить “нашу” новую сделку.

Принцип работы распределения

Если был найден контакт, то ответственным по сделке ставится пользователь ответственный по контакту (даже если это администратор).
Если же контакт не был найден, то ответственный выбирается по принципу равномерного распределения сделок между пользователями за текущие сутки (считаем все сделки за текущие сутки для каждого пользователя CRM и ставим ответственным того, у кого наименьшее количество сделок).
Количество сделок за текущие сутки у которых один и тот же контакт считать как одна сделка.
Администратор (владелец аккаунта) не участвует в распределении сделок от новых контактов.
